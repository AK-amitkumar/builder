<?xml version="1.0"?>
<openerp>
    <data>
        <record model="document.template" id="builder_base_xml">
                    <field name="name">builder.base.xml</field>
                    <field name="title">builder.base.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<?xml version="1.0"?>
<openerp>
    <data>
        {% block content %}
        {% endblock %}
    </data>
</openerp>]]></field>
        </record>
        
        <record model="document.template" id="builder_menu_xml">
                    <field name="name">builder.menu.xml</field>
                    <field name="title">builder.menu.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- extends 'builder.base.xml' %}

{% block content %}
    <menuitem name="{{module.shortdesc}}" id="{{module.name}}_menu_root" />
{% endblock %}]]></field>
        </record>
        
        <record model="document.template" id="builder_models_py">
                    <field name="name">builder.models.py</field>
                    <field name="title">builder.models.py</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- include 'builder.python_file_header.py' ignore missing %}
from openerp import models, fields, api, tools, _
#from openerp.osv import fields as fields_old
#import openerp.addons.decimal_precision as dp
{% for model in models %}
class {{model.model|replace(".", " ")|replace("_", " ")|title()|replace(" ","")}}({% if model.osv_memory %}models.AbstractModel{% else %}models.Model{% endif %}):
    _name = '{{model.model}}'
    {% if model.inherit_model_ids -%}_inherit = [{%- for inherit in model.inherit_model_ids -%}
            {%- if inherit.system_model_id.model -%}
                '{{inherit.system_model_id.model}}',
            {%- endif -%}
                {%- if inherit.module_model_id.model -%}
            '{{inherit.module_model_id.model}}',
            {%- endif -%}
        {%- endfor -%}]
    {%- endif %}
    {% if model.inherit_model_ids -%}_inherits = {{'{'}} {%- for inherits in model.inherits_model_ids -%}
            {%- if inherits.system_model_id.model -%}
                '{{inherits.system_model_id.model}}' : '{{inherits.field_name}}',
            {%- endif -%}
                {%- if inherits.module_model_id.model -%}
            '{{inherits.module_model_id.model}}' : '{{inherits.field_id}}',
            {%- endif -%}
        {%- endfor -%} {{'}'}}
    {%- endif %}
    {% if model.info %}_description = '{{model.info}}'{% endif -%}
    {%- for field in model.field_ids %}
    {{field.name}} = fields.{{field.ttype.capitalize()}}(
                    {%- if field.ttype == 'many2many' %} '{{field.relation_model_id.model}}', {%- endif %}
                    {%- if field.ttype == 'many2one' %} '{{field.relation_model_id.model}}', ondelete='{{field.on_delete.lower()}}', {%- endif %}
                    {%- if field.ttype == 'one2many' %} '{{field.relation_model_id.model}}', '{{field.relation_field}}', {%- endif %}
                    {%- if field.ttype == 'char' %} {%- if field.size %} size={{field.size}}, {% endif %}{%- if field.translate -%}translate=True,{% endif %}{%- endif %}
                    {%- if field.ttype == 'text' %} {%- if field.translate -%}translate=True, {% endif %}{%- endif %}
                    {%- if field.ttype == 'float' %} {%- if field.digits -%} digits=({{field.digits}}),{% endif %}{%- endif %}
                    {%- if field.required %} required=True,{% endif %}
                    {%- if field.readonly %} readonly=True,{% endif %}
                    {%- if field.field_description %} string='{{field.field_description}}',{% endif %}
                    {%- if field.string %} string='{{field.string}}',{% endif %}
                    {%- if field.help %} help='{{field.help}}',{% endif %}
                    {%- if field.index %} index=True,{% endif %}
                    {%- if field.selection %} selection={{field.selection}},{% endif %}
                    {%- if field.compute -%} compute='{{field.compute_method_name}}',{% endif %}
                    {%- if field.inverse -%} inverse='{{field.inverse_method_name}}',{% endif %})
    {%- endfor %}
    {% for field in model.field_ids %}
    {%- if field.compute %}
    @api.one()
    def {{ field.compute_method_name }}(self):
        {{field.compute_method|indent}}
    {% endif %}
    {%- if field.inverse %}
    @api.one()
    def {{ field.inverse_method_name }}(self):
        {{ field.inverse_method|indent}}
    {% endif %}
    {%- endfor %}
{% endfor %}]]></field>
        </record>
        
        <record model="document.template" id="builder_openerp_py">
                    <field name="name">builder.__openerp__.py</field>
                    <field name="title">builder.__openerp__.py</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- include 'builder.python_file_header.py' ignore missing %}
# noinspection PyStatementEffect
{
    "name" : "{{module.name}}",
{% if module.installed_version %}    "version" : "{{module.installed_version}}",{% endif %}
{% if module.author %}    "author" : "{{module.author}}",{% endif %}
{% if module.website %}    "website" : "{{module.website}}",{% endif %}
{% if module.category_id %}    "category" : "{{module.category_id}}",{% endif %}
    "licence" : "{{module.license}}",
    "description": """
{{module.shortdesc}}
====================================
{{module.summary}}
                    """,
    "depends" : {{ module.dependencies_as_list()[0] }},
    "data" : [
                {% for item in data -%}
                '{{item}}',
                {% endfor  -%}
            ],
    "demo" : [
            {%- for item in demo -%}
                '{{item}}',
            {%- endfor  -%}
    ],
    "installable": True,
    "auto_install": {{module.auto_install}},
    "application": {{module.application}},
}]]></field>
        </record>
        <record model="document.template" id="builder_python_file_header_py">
                    <field name="name">builder.python_file_header.py</field>
                    <field name="title">builder.python_file_header.py</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
# -*- coding: utf-8 -*-
##############################################################################
#
#    OpenERP, Open Source Management Solution
#    Copyright (C) 2004-2010 Tiny SPRL (<http://tiny.be>).
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU Affero General Public License as
#    published by the Free Software Foundation, either version 3 of the
#    License, or (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU Affero General Public License for more details.
#
#    You should have received a copy of the GNU Affero General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
##############################################################################
{% block content %} {% endblock %}
                    ]]></field>
        </record>
        <record model="document.template" id="builder_python_init_py">
                    <field name="name">builder.python.__init__.py</field>
                    <field name="title">builder.python.__init__.py</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{% include 'builder.python_file_header.py' ignore missing %}
{% for pack in packages -%}
    from . import {{pack}}
{% endfor %}]]></field>
        </record>
        <record model="document.template" id="view_form_macros_xml">
                    <field name="name">view_form_macros.xml</field>
                    <field name="title">view_form_macros.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{% macro tree_tag(model, editable=False, extra='') -%}
    <tree string="{{model.class_name}}" {% if editable %}editable="{{editable}}"{% endif %} {{extra}} >
        {% for attr in model.view_tree_attributes -%}
            <field name="{{attr.name}}" />
        {% endfor -%}
    </tree>
{%- endmacro %}


{% macro form_field(model, field) -%}
    {% if field.type in ["many2many", "one2many"] %}
        <field name="{{field.name}}" mode="tree" {% if field.options['widget'] %}widget="{{field.options['widget']}}"{% endif %}>
            {{ tree_tag(field.options.related_class, editable="bottom") }}
        </field>
    {% else -%}
        <field name="{{field.name}}" {% if field.options['widget'] %}widget="{{field.options['widget']}}"{% endif %}/>
    {%- endif %}
{%- endmacro %}



{% macro form_tag(model) -%}
    <form string="{{model.class_name}}" version="7.0">
        <sheet>
            <group col="4">
                {% for attr in model.view_form_attributes -%}
                    {% if attr.type not in ["many2many", "one2many"] %}
                        {{ form_field(model, attr) }}
                    {% endif %}
                {% endfor -%}
            </group>


            {% for attr in model.view_form_attributes -%}
                {% if attr.type in ["many2many", "one2many"] %}
                    {{ form_field(model, attr) }}
                {% endif %}
            {% endfor -%}
        </sheet>
    </form>
{% endmacro -%}]]></field>
                </record>

        <record model="document.template" id="builder_view_arch_gantt">
                    <field name="name">builder.view_arch_gantt.xml</field>
                    <field name="title">builder.view_arch_gantt.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<gantt string="{{string}}"{% if not create %} create="false" {% endif %}{% if not edit %} edit="false" {% endif %}{% if not delete %} delete="false" {% endif %}{% if date_start %} date_start="{{date_start}}" {% endif %}{% if date_stop %} date_stop="{{date_stop}}" {% endif %}{% if date_delay %} date_delay="{{date_delay}}" {% endif %}{% if progress %} progress="{{progress}}" {% endif %}{% if default_group_by%} default_group_by="{{default_group_by}}" {% endif %}>
</gantt>]]></field>
        </record>

        <record model="document.template" id="builder_view_arch_kanban">
                    <field name="name">builder.view_arch_kanban.xml</field>
                    <field name="title">builder.view_arch_kanban.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<kanban string="{{string}}"{% if not create %} create="false" {% endif %}{% if not edit %} edit="false" {% endif %}{% if not delete %} delete="false" {% endif %}{% if default_group_by%} default_group_by="{{default_group_by}}" {% endif %}{% if not quick_create%} quick_create="false" {% endif %}>
{% for field in fields %}
    <field name="{{field.name}}" />
{%- endfor %}
{% if template %}
    <templates>
{{template}}
    <templates>
{% endif %}
</kanban>]]></field>
        </record>

            <record model="document.template" id="builder_view_arch_graph">
                    <field name="name">builder.view_arch_graph.xml</field>
                    <field name="title">builder.view_arch_graph.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<graph string="{{string}}"{% if type %} type="{{type}}" {% endif %}{% if stacked %} stacked="true" {% endif %}{% if orientation %} orientation="{{orientation}}" {% endif %}>
{% for field in fields %}
    <field name="{{field.field_id.name}}"{% if field.operator %} operator="{{field.operator}}" {% endif %}{% if field.type %} type="{{field.type}}" {% endif %}{% if field.interval %} interval="{{field.interval}}" {% endif %}/>
{%- endfor %}
</graph>]]></field>
        </record>

        <record model="document.template" id="builder_view_arch_calendar">
                    <field name="name">builder.view_arch_calendar.xml</field>
                    <field name="title">builder.view_arch_calendar.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<calendar string="{{string}}"{% if date_start %} date_start="{{date_start}}" {% endif %}{% if date_stop %} date_stop="{{date_stop}}" {% endif %}{% if date_length %} date_length="{{date_length}}" {% endif %}{% if date_delay %} date_delay="{{date_delay}}" {% endif %}{% if day_length %} day_length="{{day_length}}" {% endif %}{% if all_day %} all_day="true" {% endif %}{% if use_contacts %} use_contacts="true" {% endif %}{% if color %} color="{{color}}" {% endif %}{% if color_is_attendee %} color_is_attendee="true" {% endif %}{% if event_open_popup %} event_open_popup="{{event_open_popup}}" {% endif %}{% if avatar_filter %} avatar_filter="{{avatar_filter}}" {% endif %}{% if avatar_model %} avatar_model="{{avatar_model}}" {% endif %}{% if avatar_title %} avatar_title="{{avatar_title}}" {% endif %}{% if not quick_add %} quick_add="false" {% endif %}{% if display %} display="{{display}}" {% endif %}>
{% for field in fields %}
    <field name="{{field.field_id.name}}"{% if field.invisible %} invisible="True" {% endif %} />
{%- endfor %}
</calendar>]]></field>
        </record>

        <record model="document.template" id="builder_view_arch_tree">
                    <field name="name">builder.view_arch_tree.xml</field>
                    <field name="title">builder.view_arch_tree.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<tree string="{{string}}"{% if not create %} create="false" {% endif %}{% if not edit %} edit="false" {% endif %}{% if not delete %} delete="false" {% endif %}{% if toolbar %} toolbar="True" {% endif %}{% if fonts %} fonts="{{fonts}}" {% endif %}{% if colors %} colors="{{colors}}" {% endif %}>
{% for field in fields %}
    <field name="{{field.field_id.name}}"{% if field.invisible %} invisible="True" {% endif %}{% if field.widget %} widget="{{field.widget}}" {% endif %}{% if field.widget_options %} widget_options="{{field.widget_options}}" {% endif %}{% if field.readonly %} readonly="{{field.readonly}}" {% endif %}{% if field.domain %} domain="{{field.domain}}" {% endif %} />
{%- endfor %}
</tree>]]></field>
        </record>

        <record model="document.template" id="builder_view_arch_search">
                    <field name="name">builder.view_arch_search.xml</field>
                    <field name="title">builder.view_arch_search.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<search string="{{string}}">
{% for field in ungrouped_fields %}
    {% if field.type == 'filter' -%}
        <filter {% if field.attr_name %}name="{{field.attr_name}}" {% endif %}{% if field.attr_string %} string="{{field.attr_string}}" {% endif %}{% if field.attr_domain %} domain="{{field.attr_domain}}" {% endif %}{% if field.attr_filter_domain %} filter_domain="{{field.attr_filter_domain}}" {% endif %}{% if field.attr_operator %} operator="{{field.attr_operator}}" {% endif %}{% if field.attr_help %} help="{{field.attr_help}}" {% endif %}{% if field.group_field_id %} context="{'group_by':'{{field.group_field_id.name}}'}" {% endif %} />
    {%- elif field.type == 'field' -%}
        <field name="{{field.field_id.name}}"{% if field.attr_string %} string="{{field.attr_string}}" {% endif %}{% if field.attr_domain %} domain="{{field.attr_domain}}" {% endif %}{% if field.attr_filter_domain %} filter_domain="{{field.attr_filter_domain}}" {% endif %}{% if field.attr_operator %} operator="{{field.attr_operator}}" {% endif %}{% if field.attr_help %} help="{{field.attr_help}}" {% endif %}{% if field.group_field_id %} context="{'group_by':'{{field.group_field_id.name}}'}" {% endif %} />
    {%- elif field.type == 'separator' -%}
        <separator  />
    {%- endif %}
{%- endfor %}
{% for k, item in groups.items() %}
    <group string="{{item.group.name}}">
        {%- for field in item.fields %}
            {% if field.type == 'filter' -%}
                <filter {% if field.attr_name %}name="{{field.attr_name}}" {% endif %}{% if field.attr_string %} string="{{field.attr_string}}" {% endif %}{% if field.attr_domain %} domain="{{field.attr_domain}}" {% endif %}{% if field.attr_filter_domain %} filter_domain="{{field.attr_filter_domain}}" {% endif %}{% if field.attr_operator %} operator="{{field.attr_operator}}" {% endif %}{% if field.attr_help %} help="{{field.attr_help}}" {% endif %}{% if field.group_field_id %} context="{'group_by':'{{field.group_field_id.name}}'}" {% endif %} />
            {%- elif field.type == 'field' -%}
                <field name="{{field.field_id.name}}"{% if field.attr_string %} string="{{field.attr_string}}" {% endif %}{% if field.attr_domain %} domain="{{field.attr_domain}}" {% endif %}{% if field.attr_filter_domain %} filter_domain="{{field.attr_filter_domain}}" {% endif %}{% if field.attr_operator %} operator="{{field.attr_operator}}" {% endif %}{% if field.attr_help %} help="{{field.attr_help}}" {% endif %}{% if field.group_field_id %} context="{'group_by':'{{field.group_field_id.name}}'}" {% endif %} />
            {%- elif field.type == 'separator' -%}
                <separator  />
            {%- endif %}
        {%- endfor %}
    </group>
{% endfor %}
</search>]]></field>
        </record>

        <record model="document.template" id="builder_view_arch_form">
                    <field name="name">builder.view_arch_form.xml</field>
                    <field name="title">builder.view_arch_form.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[<form version="7.0" string="{{string}}" {% if not create %} create="false" {% endif %}{% if not edit %} edit="false" {% endif %}{% if not delete %} delete="false" {% endif %}>
{% for field in flat_fields %}
    <field name="{{field.field_id.name}}"{% if field.attr_string %} string="{{field.attr_string}}" {% endif %}{% if field.attr_domain %} domain="{{field.attr_domain}}" {% endif %}{% if field.attr_filter_domain %} filter_domain="{{field.attr_filter_domain}}" {% endif %}{% if field.attr_operator %} operator="{{field.attr_operator}}" {% endif %}{% if field.attr_help %} help="{{field.attr_help}}" {% endif %}{% if field.group_field_id %} context="{'group_by':'{{field.group_field_id.name}}'}" {% endif %} />
{%- endfor %}
</search>]]></field>
        </record>

        <record model="document.template" id="builder_view_arch_form">
                    <field name="name">builder.view.xml</field>
                    <field name="title">builder.view.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- extends 'builder.base.xml' %}
{% block content %}
{% for view in models %}
            <record model="ir.ui.view" id="{{view.xml_id}}">
                <field name="name">{{view.name}}</field>
                <field name="model">{{view.model_id.model}}</field>
                <field name="priority" eval="16"/>
                <field name="arch" type="xml">
                <{{view.type}}>
                    {{view.arch|indent}}
                </{{view.type}}>
                </field>
            </record>
{% endfor %}
{% endblock %}]]></field>
        </record>
        
        <record model="document.template" id="builder_website_assets_xml">
                    <field name="name">builder.website_assets.xml</field>
                    <field name="title">builder.website_assets.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- extends 'builder.base.xml' %}

{% block content %}
    {% for asset in assets %}
        <template id="{{module.name}}.{{asset.attr_id}}" name="{{asset.attr_name}}" inherit_id="{{asset.type}}" {% if asset.type == 'website.theme' %} {% if not asset.attr_active %}active="False"{% endif %} customize_show="{{asset.attr_customize_show}}" {% endif %}>
            {% if asset.type == 'website.theme' -%}
            <xpath expr="//link[@id='bootstrap_css']" position="after">
            {% else -%}
            <xpath expr="." position="inside">
            {% endif -%}
                {% for item in asset.item_ids -%}
                    {% if item.file_id.extension == '.css' -%}
                        <link rel="stylesheet" href="/{{module.name}}{{item.file_id.path}}" t-ignore="true"/>
                    {% elif  item.file_id.extension == '.js' -%}
                        <script type="text/javascript" src="/{{module.name}}{{item.file_id.path}}" t-ignore="true"/>
                    {% endif -%}
                {% endfor -%}
            </xpath>
        </template>
    {% endfor %}
{% endblock %}]]></field>
                </record>

        <record model="document.template" id="builder_website_pages_xml">
                    <field name="name">builder.website_pages.xml</field>
                    <field name="title">builder.website_pages.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- extends 'builder.base.xml' %}

{% block content %}
    {% for page in pages %}
        <template id="website.{{page.attr_id}}" name="{{page.attr_name}}" page="True" {% if page.priority %}priority="{{page.priority}}" {% endif %}>
            <t t-call="{{page.wrap_layout}}">
                <div id="wrap" class="oe_structure oe_empty">
                    {{page.content}}
                </div>
            </t>
        </template>

    {% endfor %}

    {% for menu in menus %}
        <record id="website_menu_{{menu.page_id.attr_id}}" model="website.menu">
            <field name="name">{{menu.name}}</field>
            <field name="url">{{menu.url}}</field>
            {% if menu.parent_id %}
                <field name="parent_id" ref="{{module.name}}.website_menu_{{menu.parent_id.page_id.attr_id}}"/>
            {% else %}
                <field name="parent_id" ref="website.main_menu"/>
            {% endif %}
            <field name="sequence" type="int">{{menu.sequence}}</field>
        </record>
    {% endfor %}
{% endblock %}]]></field>
                </record>

        <record model="document.template" id="builder_website_themes_xml">
                    <field name="name">builder.website_themes.xml</field>
                    <field name="title">builder.website_themes.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- extends 'builder.base.xml' %}

{% block content %}

    <template id="themes" inherit_id="website.themes" name="Themes">
            <xpath expr="//div[@id='themes-list']" position="inside">
                {% for theme in themes %}
                <div class="col-md-4">
                    <div class="well text-center">
                        {% if theme.image %}
                        <div class="image">
                            <img class="img-responsive" src="/{{module.name}}/static/themes/{{theme.asset_id.attr_id}}.png" alt="{{theme.attr_name}}" style="width: 360px"/>
                        </div>
                        {% endif %}
                        <div class="options">
                            <h3>{{theme.attr_name}}</h3>
                            <p>{{theme.attr_description}}</p>
                            <a class="btn btn-info" href="/website/theme_change?theme_id={{module.name}}.{{theme.asset_id.attr_id}}">Apply</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </xpath>
        </template>
{% endblock %}]]></field>
                </record>

        <record model="document.template" id="builder_website_snippets_xml">
                    <field name="name">builder.website_snippets.xml</field>
                    <field name="title">builder.website_snippets.xml</field>
                    <field name="type">jinja</field>
                    <field name="content"><![CDATA[
{%- extends 'builder.base.xml' %}

{% block content %}
   <template id="{{module.name}}.snippets" inherit_id="website.snippets" name="Snippets">
   {% for custom, snippets in snippet_type.items() %}
       {% if custom %}
                <xpath expr="//ul[@class='nav navbar-nav nav-tabs']" position="inside">
                    <li>
                        <a href="#snippet_{{module.name}}" data-toggle="tab">{{module.name}}</a>
                    </li>
                </xpath>

                <xpath expr="//div[@class='tab-content']" position="inside">
                    <div id="snippet_{{module.name}}" class="tab-pane fade">
                        {% for snippet in snippets %}
                            <div>
                                <div class="oe_snippet_thumbnail">
                                    {% if snippet.image %}
                                        <img class="oe_snippet_thumbnail_img" src="data:image/png;base64,{{snippet.image}}"/>
                                    {% else %}
                                        <span data-size="fa-5x" class="fa-4x fa fa-question-circle" style="line-height: inherit;"></span>
                                    {% endif %}
                                    <span class="oe_snippet_thumbnail_title">{{snippet.name}}</span>
                                </div>
                                <section class="oe_snippet_body">
                                    <div class="oe_structure">
                                        {{snippet.content}}
                                    </div>
                                </section>
                            </div>
                        {% endfor %}
                    </div>
                </xpath>
        {% else  %}
        <xpath expr="//div[@id='snippet_content']" position="inside">
            {% for snippet in snippets %}
                <div>
                    <div class="oe_snippet_thumbnail">
                        {% if snippet.image %}
                            <img class="oe_snippet_thumbnail_img" src="data:image/png;base64,{{snippet.image}}"/>
                        {% else %}
                            <span data-size="fa-5x" class="fa-4x fa fa-question-circle" style="line-height: inherit;"></span>
                        {% endif %}
                        <span class="oe_snippet_thumbnail_title">{{snippet.name}}</span>
                    </div>
                    <section class="oe_snippet_body">
                        <div class="oe_structure">
                            {{snippet.content}}
                        </div>
                    </section>
                </div>
            {% endfor %}
        </xpath>
        {% endif  %}
   {% endfor %}
   </template>
{% endblock %}
]]></field>
                </record>
    </data>
</openerp>